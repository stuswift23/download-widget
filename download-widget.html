<!DOCTYPE html>
<html>
<head>
  <title>Download Recording</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    label, input, button {
      margin: 5px 0;
      display: block;
    }
  </style>
</head>
<body>
  <h2>ðŸ”Ž Search & Download Recording</h2>
  <label for="taskId">Enter Task ID:</label>
  <input type="text" id="taskId" placeholder="e.g. 1234567890..." />
  <button onclick="fetchRecording()">Get Recording</button>
  <p id="result"></p>
  <script>
    async function fetchRecording() {
      const taskId = document.getElementById("taskId").value;
      const accessToken = window.frameElement.getAttribute("access-token");
      const orgId = window.frameElement.getAttribute("org-id");

      if (!taskId || !accessToken || !orgId) {
        document.getElementById("result").innerText = "Missing input or auth.";
        return;
      }

      const payload = {
        query: {
          orgId,
          urlExpiration: 0,
          taskIds: [taskId],
          includeSegments: false
        }
      };

      try {
        const response = await fetch("https://api.wxcc-us1.cisco.com/v1/captures/query", {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + accessToken,
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const data = await response.json();
        const url = data?.[0]?.url;

        if (url) {
          document.getElementById("result").innerHTML = `
            âœ… Recording found: <a href="${url}" download target="_blank">Download</a>
          `;
        } else {
          document.getElementById("result").innerText = "Recording not found.";
        }
      } catch (err) {
        console.error(err);
        document.getElementById("result").innerText = "Failed to fetch recording.";
      }
    }
  </script>
</body>
</html>
